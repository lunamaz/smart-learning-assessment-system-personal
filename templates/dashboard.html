{% extends "base.html" %}

{% block title %}學習中心 - {{ child.nickname }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-tachometer-alt text-primary me-2"></i>
                    歡迎回來，{{ child.nickname }}！
                </h2>
                <div>
                    <a href="{{ url_for('child_selection') }}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-exchange-alt me-1"></i>切換檔案
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 學習統計概覽 -->
    <div class="row mb-5">
        <div class="col-md-3 mb-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <i class="fas fa-book fa-2x mb-2"></i>
                    <h4>{{ stats|length }}</h4>
                    <p class="mb-0">已學習科目</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <i class="fas fa-clock fa-2x mb-2"></i>
                    <h4>
                        {% set total_time = stats.values() | map(attribute='total_time') | sum %}
                        {{ total_time }}
                    </h4>
                    <p class="mb-0">總學習時間(分)</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <i class="fas fa-eye fa-2x mb-2"></i>
                    <h4>
                        {% set total_sessions = stats.values() | map(attribute='count') | sum %}
                        {{ total_sessions }}
                    </h4>
                    <p class="mb-0">學習次數</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <i class="fas fa-star fa-2x mb-2"></i>
                    <h4>
                        {% if stats %}
                            {% set avg_attention = (stats.values() | map(attribute='avg_attention') | sum) / (stats|length) %}
                            {{ "%.0f" | format(avg_attention * 100 / 3) }}%
                        {% else %}
                            0%
                        {% endif %}
                    </h4>
                    <p class="mb-0">平均專注度</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 功能快捷入口 -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <a href="{{ url_for('data_analysis') }}" class="text-decoration-none">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                        <h5 class="card-title">數據分析</h5>
                        <p class="card-text text-muted">查看詳細的學習數據與視覺化圖表</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-6 mb-3">
            <a href="{{ url_for('smart_suggestions') }}" class="text-decoration-none">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-lightbulb fa-3x text-warning mb-3"></i>
                        <h5 class="card-title">智慧建議</h5>
                        <p class="card-text text-muted">獲取個人化學習建議與分析報告</p>
                    </div>
                </div>
            </a>
        </div>
    </div>
    
    <!-- 學科選擇 -->
    <div class="row">
        <div class="col-12">
            <h3 class="mb-4">
                <i class="fas fa-graduation-cap text-primary me-2"></i>
                選擇學習科目
            </h3>
        </div>
    </div>
    
    <div class="row">
        {% for subject_key, subject_name in subjects.items() %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 subject-card" data-subject="{{ subject_key }}">
                <div class="card-body text-center">
                    <div class="subject-icon mb-3">
                        {% if subject_key == 'math' %}
                            <i class="fas fa-calculator fa-3x text-primary"></i>
                        {% elif subject_key == 'science' %}
                            <i class="fas fa-flask fa-3x text-success"></i>
                        {% elif subject_key == 'language' %}
                            <i class="fas fa-book-open fa-3x text-danger"></i>
                        {% elif subject_key == 'social' %}
                            <i class="fas fa-globe fa-3x text-info"></i>
                        {% elif subject_key == 'art' %}
                            <i class="fas fa-palette fa-3x text-warning"></i>
                        {% elif subject_key == 'cs' %}
                            <i class="fas fa-code fa-3x text-dark"></i>
                        {% endif %}
                    </div>
                    
                    <h5 class="card-title">{{ subject_name }}</h5>
                    
                    {% if subject_key in stats %}
                    <div class="subject-stats">
                        <small class="text-muted">
                            已學習 {{ stats[subject_key].count }} 次 |
                            總時長 {{ stats[subject_key].total_time }} 分鐘
                        </small>
                        <div class="progress mt-2">
                            <div class="progress-bar" role="progressbar" 
                                 style="width: {{ stats[subject_key].avg_attention * 100 / 3 }}%">
                                專注度: {{ "%.0f" | format(stats[subject_key].avg_attention * 100 / 3) }}%
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <small class="text-muted">尚未開始學習</small>
                    {% endif %}
                    
                    <div class="mt-3">
                        <a href="{{ url_for('study_session', subject=subject_key) }}" 
                           class="btn btn-primary">
                            <i class="fas fa-play me-2"></i>開始學習
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}